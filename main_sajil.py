import sajil_part_one
import sajil_part_two
import keyboards 
import utils 
import os 
from typing import Dict, Any 

# ==============================================================================
# ุชุงุจุน ุงุตู ฺฉู ุงุฒ bot_app.py ูุฑุงุฎูุงู ูโุดูุฏ
# ==============================================================================

async def run_sajil_workflow(chat_id: int, incoming_text: str):
    """
    ุฌุฑุงู ฺฉุงุฑ ุณุฌู: ุฏุฑุงูุช ุงุนุฏุงุฏ/ฺฉููุงุช ฺฉูุฏ ู ุชููุฏ ููุงุฏ ูพุดููุงุฏ.
    """
    
    # 1. Escape ฺฉุฑุฏู ูุชู ูุฑูุฏ ฺฉุงุฑุจุฑ ุจุฑุง ูุฑุงุฑฺฏุฑ ุงูู ุฏุฑ Code Block Inline
    # (ููุท ุจฺฉโุชฺฉ ู ุจฺฉโุงุณูุด Escape ูโุดููุฏ)
    escaped_input_for_code_block = utils.escape_code_block(incoming_text) 
    
    # 2. ุณุงุฎุช ูพุงู ุจุง ุชุฑฺฉุจ ุจุฎุดโูุง Escape ุดุฏู ู Code Block
    
    # ุจุฎุด ุซุงุจุช ุงูู: ุชูุงู ฺฉุงุฑุงฺฉุชุฑูุง ุฑุฒุฑู ุดุฏู (ูุงููุฏ ููุทู ู ูพุฑุงูุชุฒ) Escape ูโุดููุฏ.
    header = utils.escape_markdown_v2(
        "โ **ุงุทูุงุนุงุช ุณุฌู ุฏุฑุงูุช ุดุฏ!**\n\n"
        "ุดูุง ุฏุงุฏูโูุง ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉุฑุฏุฏ: "
    )
    
    # ุจุฎุด Code Block: ุดุงูู ุจฺฉโุชฺฉโูุง ูุงูโุงุณฺฉูพ (ุจุฑุง ุชูฺฏุฑุงู) ู ูุฑูุฏ Escape ุดุฏู
    code_block_part = f"`{escaped_input_for_code_block}`"
    
    # ุจุฎุด ุซุงุจุช ุฏูู: ูุชูโูุง ูพุงุงู ูพุงู ฺฉู ุจุงุฏ Escape ุดููุฏ.
    footer = utils.escape_markdown_v2(
        "\nุชุญูู ููุงุฏุดูุงุณุงูู ู ุชููุฏ ุณุฌู (ููุงุฏ) ุจุฑ ุงุณุงุณ ุงุตูู ฺฏูุงุชุฑุง ู ุนุฏุฏุดูุงุณ ุงูุฌุงู ูโุดูุฏ.\n\n"
        "**ููุงุฏ ูพุดููุงุฏ:** (ูุงุฒ ุจู ูพุงุฏูโุณุงุฒ ููุทู ุจุตุฑ ุง ุชููุฏ ฺฏุฑุงูฺฉ)\n"
        "*ุงู ุจุฎุด ุจุฑุง ุชููุฏ ฺฏุฑุงูฺฉ ู ุชุญูู ุนููโุชุฑ ุจู ูุงฺููโูุง sajil_part_one ู sajil_part_two ุงุฑุณุงู ุดุฏ.*"
    )
    
    # 3. ุชุฑฺฉุจ ู ุงุฑุณุงู ูพุงู
    output = header + code_block_part + footer
    
    # ๐ก ุชูุฌู: utils.send_message ุงุฒ ูุจู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ MarkdownV2 ุชูุธู ุดุฏู ุงุณุช.
    await utils.send_message(
        os.environ.get("BOT_TOKEN"), 
        chat_id, 
        output, 
        keyboards.services_menu_keyboard() 
    )
    
